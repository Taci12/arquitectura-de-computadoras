ESTADO EQU 41H
DATO EQU 40H
INT2 EQU 26H
IMR EQU 21H
EOI EQU 20H
ID_HND EQU 10

ORG 1000H
CARACTERES DB ?
DB ?
DB ?
DB ?
DB ?
FIN DB ?

ORG 3000H
LEER: PUSH AX
PUSH BX
PUSH CX
PUSH DX
; CX offset fin, BX offset caracteres
LOOP: CMP BX, CX
JZ RETORNO
INT 6
INC BX
JMP LOOP

RETORNO: POP DX
POP CX
POP BX
POP AX
RET
  
ORG 2000H
CLI
MOV AL, 11111011B
OUT IMR, AL; desenmascaro la int del handshake
IN AL, ESTADO
AND AL, 07FH
OUT ESTADO, AL; modifico el estado para hacerlo por polling
MOV AL, ID_HND
OUT INT2, AL; asigno al PIC el ID del gestor
MOV BX, OFFSET CARACTERES
MOV CX, OFFSET FIN
CALL LEER; leo los 5 chars
STI
LAZO: CMP BX, CX
JZ AL_REVES
POLL: IN AL, ESTADO
AND AL, 1
JNZ POLL
MOV AL, [BX]
OUT DATO, AL
INC BX
JMP LAZO

AL_REVES: DEC BX 
SUB CX, 6H
LAZO_2: CMP BX, CX
JZ TERMINAR
POLL_2: IN AL, ESTADO
AND AL, 1
JNZ POLL_2
MOV AL, [BX]
OUT DATO, AL
DEC BX
JMP LAZO_2

TERMINAR: HLT
END














